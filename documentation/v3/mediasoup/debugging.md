---
title   : Debugging
anchors : true
---


# mediasoup v3 Debugging

* Will be replaced with the ToC
{: toc}


## Log Levels
{: #Log-Level}

mediasoup uses the [debug](https://www.npmjs.com/package/debug) module to log internal information. The JavaScript layer of mediasoup produces its own logs and also collects logs generated by the media worker subprocesses.

There are four log severities:

* **debug**: verbose information logged to `stdout`
* **warn**: warning messages logged to `stderr`
* **error**: error messages logged to `stderr`
* **none**: nothing is logged

All the logs generated by mediasoup have a namespace starting with "mediasoup" plus colon, followed by the log severity in upper case plus colon (just if "warn" or "error"), and followed by the internal component name (if any) and the log message.

Log messages generated by media worker subprocesses deserve a special treatment. They are just generated if their severity is equal or higher than the given [logLevel](/documentation/v3/mediasoup/api/#WorkerSettings), but they are just logged if the value of the `DEBUG` environment variable matches their namespace.

Logs generated by the media worker subprocesses can have the following namespaces (where NNNNN is the subprocess PID):

* "mediasoup:worker[pid:NNNNNN]"
* "mediasoup:WARN:worker[pid:NNNNNN]"
* "mediasoup:ERROR:worker[pid:NNNNNN]"

Logging example once mediasoup is started:

```
mediasoup:worker[pid:80653] mediasoup-worker::main() | starting mediasoup-worker process [version:3.0.0-dev] +0ms
mediasoup:worker[pid:80653] mediasoup-worker::main() | little-endian CPU detected +0ms
mediasoup:worker[pid:80653] mediasoup-worker::main() | 64 bits architecture detected +1ms
mediasoup:worker[pid:80653] Settings::PrintConfiguration() | <configuration> +0ms
mediasoup:worker[pid:80653] Settings::PrintConfiguration() |   logLevel            : debug +0ms
mediasoup:worker[pid:80653] Settings::PrintConfiguration() |   logTags             : info,simulcast +0ms
mediasoup:worker[pid:80653] Settings::PrintConfiguration() |   rtcMinPort          : 40000 +0ms
mediasoup:worker[pid:80653] Settings::PrintConfiguration() |   rtcMaxPort          : 49999 +0ms
mediasoup:worker[pid:80653] Settings::PrintConfiguration() | </configuration> +0ms
mediasoup:worker[pid:80653] DepLibUV::PrintVersion() | libuv version: "1.27.0" +0ms
mediasoup:worker[pid:80653] DepOpenSSL::ClassInit() | openssl version: "OpenSSL 1.1.1b  26 Feb 2019" +0ms
mediasoup:worker[pid:80653] DepLibSRTP::ClassInit() | libsrtp version: "libsrtp 2.0.0" +0ms
mediasoup:Worker worker process running [pid:80653] +28ms
mediasoup:Worker createRouter() +1m
mediasoup:Channel[pid:80653] request() [method:worker.createRouter, id:1] +1m
mediasoup:Channel[pid:80653] request succeeded [method:worker.createRouter, id:1] +4ms
mediasoup:Router constructor() +0ms
mediasoup:Channel[pid:80653] request() [method:router.createWebRtcTransport, id:3] +360ms
mediasoup:Channel[pid:80653] request succeeded [method:router.createWebRtcTransport, id:3] +4ms
mediasoup:Transport constructor() +0ms
mediasoup:WebRtcTransport constructor() +0ms
mediasoup:Transport setMaxIncomingBitrate() [bitrate:1500000] +4ms
mediasoup:Channel[pid:80653] request() [method:transport.setMaxIncomingBitrate, id:4] +8ms
mediasoup:Channel[pid:80653] request succeeded [method:transport.setMaxIncomingBitrate, id:4] +2ms
```


## Enable Logging
{: #Enable-Logging}

By default logging is turned off. In order to enable it, the `DEBUG` environment variable must be set *before* loading mediasoup.

<div markdown="1" class="note">
Check the [debug](https://www.npmjs.com/package/debug) module documentation for further information regarding how to filter specific log messages based on namespace matching rules.
</div>


### Examples
{: #Enable-Logging-Examples}

* Set `DEBUG` environment variable before running your Node.js application:

```bash
$ export DEBUG="mediasoup*"
$ node myapp.js

# or:

$ DEBUG="mediasoup*" node myapp.js
```

* Or set the `DEBUG` environment variable in Node.js before loading mediasoup:

```javascript
process.env.DEBUG = "mediasoup*"

const mediasoup = require("mediasoup");
```

* Log everything (including logs generated by other libraries using the debug module such as [Express](https://expressjs.com/en/guide/debugging.html)):

```bash
$ DEBUG="*" node myapp.js
```

* Just log messages generated by mediasoup:

```bash
$ DEBUG="mediasoup*" node myapp.js
```

* Just log WARN and ERROR messages generated by mediasoup:

```bash
$ DEBUG="mediasoup:WARN:* mediasoup:ERROR:*" node myapp.js
```


## Log Tags
{: #Log-Tags}

Certain log categories can be enabled in runtime for debugging purposes by using [logTags](/documentation/v3/mediasoup/api/#WorkerSettings). Those tags just apply to logs generated by media worker subprocesses.

<div markdown="1" class="note">
Remember: These logs are just generated if their severity is equal or higher than the given [logLevel](/documentation/v3/mediasoup/api/#WorkerSettings), but they are just logged if the value of the `DEBUG` environment variable matches their namespace.
</div>


### Examples
{: #Log-Tags-Examples}

* Log all RTCP warnings and any kind of error:

```bash
$ DEBUG="mediasoup:WARN:* mediasoup:ERROR:*" node myapp.js
```

```javascript
const mediasoup = require("mediasoup");

const worker = await mediasoup.createWorker(
  {
    logLevel : "warn",
    logTags  : [ "rtcp" ]
  });
```

* Log all ICE and DTLS debugs/warnings and any kind of error:

```bash
$ DEBUG="mediasoup* *ERROR*" node myapp.js
```

```javascript
const mediasoup = require("mediasoup");

const worker = await mediasoup.createWorker(
  {
    logLevel : "debug",
    logTags  : [ "ice", "dtls" ]
  });
```

* Change settings in runtime to just enable ICE and DTLS warning logs:

```javascript
worker.updateSettings(
  {
    logLevel : "warn",
    logTags  : [ "ice", "dtls" ]
  });
```


## "trace" Event
{: #trace-Event}

Transports, producers and consumers provide a `enableTraceEvent()` method to enable the "trace" event for RTP/RTCP monitoring purposes:

* [transport.enableTraceEvent()](/documentation/v3/mediasoup/api/#transport-enableTraceEvent).
* [producer.enableTraceEvent()](/documentation/v3/mediasoup/api/#producer-enableTraceEvent).
* [consumer.enableTraceEvent()](/documentation/v3/mediasoup/api/#consumer-enableTraceEvent).

Based on enabled `types`, here the information the "trace" event provides with:


### Transport
{: #trace-Event-Transport}

#### transport.enableTraceEvent([ 'probation' ])
{: .code}

```javascript
transport.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {
      "isKeyFrame": false,
      "marker": "false",
      "payloadSize": 360,
      "payloadType": 127,
      "sequenceNumber": 19244,
      "size": 384,
      "spatialLayer": 0,
      "ssrc": 1234,
      "temporalLayer": 0,
      "timestamp": 239090504,
      "wideSequenceNumber": 166
    },
    "timestamp": 1513191082,
    "type": "probation"
  }
});
```

#### transport.enableTraceEvent([ 'bwe' ])
{: .code}

```javascript
transport.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {
      "availableBitrate": 1981250,
      "desiredBitrate": 1483574, 
      "effectiveDesiredBitrate": 1483574, 
      "maxBitrate": 2002824, 
      "maxPaddingBitrate": 1702400, 
      "minBitrate": 30000, 
      "startBitrate": 1981250, 
      "type": 'transport-cc'
    },
    "timestamp": 1513191082,
    "type": "bwe"
  }
});
```

### Producer
{: #trace-Event-Producer}

#### producer.enableTraceEvent([ 'rtp' ])
{: .code}

```javascript
producer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "in",
    "info": {
      "isKeyFrame": false,
      "marker": "true",
      "mid": "6",
      "payloadSize": 914,
      "payloadType": 96,
      "rid": "r1",
      "rrid": "r1",
      "sequenceNumber": 19694,
      "size": 942,
      "spatialLayer": 0,
      "ssrc": 27777256,
      "temporalLayer": 1,
      "timestamp": 1227771600,
      "wideSequenceNumber": 2413
    },
    "timestamp": 1513714260,
    "type": "rtp"
  }
});
```

#### producer.enableTraceEvent([ 'keyframe' ])
{: .code}

```javascript
producer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "in",
    "info": {
      "isKeyFrame": true,
      "marker": "false",
      "mid": "2",
      "payloadSize": 1088,
      "payloadType": 96,
      "rid": "r2",
      "rrid": "r2",
      "sequenceNumber": 14176,
      "size": 1116,
      "spatialLayer": 0,
      "ssrc": 3838709357,
      "temporalLayer": 0,
      "timestamp": 3003475216,
      "wideSequenceNumber": 62
    },
    "timestamp": 1513798049,
    "type": "keyframe"
  }
});
```

<div markdown="1" class="note">
When "keyframe" type is set, there won't be "trace" events with type "rtp" for keyframe packets but just with type "keyframe".
</div>

#### producer.enableTraceEvent([ 'nack' ])
{: .code}

```javascript
producer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {}
    "timestamp": 1544498146,
    "type": "nack"
  }
});
```

#### producer.enableTraceEvent([ 'pli' ])
{: .code}

```javascript
producer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {
      "ssrc": 87654321
    }
    "timestamp": 1544498146,
    "type": "pli"
  }
});
```

#### producer.enableTraceEvent([ 'fir' ])
{: .code}

```javascript
producer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {
      "ssrc": 95438003
    }
    "timestamp": 1544498155,
    "type": "fir"
  }
});
```

#### producer.enableTraceEvent([ 'sr' ])
{: .code}

```javascript
producer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {
      "ssrc": 15438003,
      "ntp_sec": 768723434,
      "ntp_frac": 87876,
      "rtp_ts": 23768,
      "packet_count": 100,
      "octet_count": 200
    }
    "timestamp": 164498155,
    "type": "sr"
  }
});
```

### Consumer
{: #trace-Event-Consumer}

#### consumer.enableTraceEvent([ 'rtp' ])
{: .code}

```javascript
consumer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {
      "isKeyFrame": false,
      "marker": "false",
      "payloadSize": 1,
      "payloadType": 100,
      "sequenceNumber": 6,
      "size": 21,
      "spatialLayer": 0,
      "ssrc": 198373608,
      "temporalLayer": 0,
      "timestamp": 54740510
    },
    "timestamp": 1514273430,
    "type": "rtp"
  }
});
```

#### consumer.enableTraceEvent([ 'keyframe' ])
{: .code}

```javascript
consumer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "out",
    "info": {
      "isKeyFrame": true,
      "marker": "true",
      "payloadSize": 437,
      "payloadType": 101,
      "sequenceNumber": 1,
      "size": 465,
      "spatialLayer": 0,
      "ssrc": 185272966,
      "temporalLayer": 0,
      "timestamp": 936997226,
      "wideSequenceNumber": 17
    },
    "timestamp": 1514298020,
    "type": "keyframe"
  }
});
```

<div markdown="1" class="note">
When "keyframe" type is set, there won't be "trace" events with type "rtp" for keyframe packets but just with type "keyframe".
</div>

#### consumer.enableTraceEvent([ 'nack' ])
{: .code}

```javascript
consumer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "in",
    "info": {}
    "timestamp": 1546498145,
    "type": "nack"
  }
});
```

#### consumer.enableTraceEvent([ 'pli' ])
{: .code}

```javascript
consumer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "in",
    "info": {
      "ssrc": 5698432
    }
    "timestamp": 1544798444,
    "type": "pli"
  }
});
```

#### consumer.enableTraceEvent([ 'fir' ])
{: .code}

```javascript
consumer.on('trace', (trace) =>
{
  // trace =>
  {
    "direction": "in",
    "info": {
      "ssrc": 776452943
    }
    "timestamp": 1543498101,
    "type": "fir"
  }
});
```
